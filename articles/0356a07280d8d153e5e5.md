---
title: 'microCMS ã® API ã‚’ aspida ã§å‹å®‰å…¨ã«åˆ©ç”¨ã™ã‚‹'
description: 'TypeScript ã®å‹ã‚’å®šç¾©ã§ãã‚‹ HTTP ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ©ãƒƒãƒ‘ãƒ¼ã®ç´¹ä»‹'
emoji: 'ğŸ”–'
type: 'tech' # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ['aspida', 'TypeScript', 'microCMS']
published: true
pubDate: 2020/10/13
---

# ã¯ã˜ã‚ã«

aspida ã¯ API ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«å‹å®šç¾©ãŒã§ãã‚‹ HTTP ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ©ãƒƒãƒ‘ãƒ¼ã§ã™ã€‚
API ã‹ã‚‰å–å¾—ã™ã‚‹å†…å®¹ã«äºˆã‚å‹ã‚’å®šç¾©ã—ã¦ãŠãã“ã¨ã§å‹å®‰å…¨ã« API ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã‚’ç›®çš„ã«ã—ã¦ã„ã¾ã™ã€‚

## ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```shell
yarn add @aspida/fetch
```

`@aspida/fetch` ã®ã»ã‹ã«ã‚‚ã€`@aspida/axios` / `@aspida/ky` / `@aspida/node-fetch` ãŒç”¨æ„ã•ã‚Œã¦ã„ã¾ã™ã€‚

# microCMS ã§ API ã‚¹ã‚­ãƒ¼ãƒã‚’è¨­å®š

microCMS ã§ãƒ†ã‚¹ãƒˆç”¨ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆã—ã¾ã—ã‚‡ã†ã€ä»Šå›ã¯è¤‡æ•°ã®ã‚¿ã‚°ãŒè¨­å®šå‡ºæ¥ã‚‹ãƒ–ãƒ­ã‚°è¨˜äº‹ã‚’æƒ³å®šã—ã¦ã„ã¾ã™ã€‚

è¨˜äº‹ã«ç´ä»˜ã‘ã‚‹ã‚¿ã‚°ã‚’ä½œã‚Šã¾ã™ã€‚ãƒªã‚¹ãƒˆå½¢å¼ã§ä¸­èº«ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ name ã ã‘ã§ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/e2pd3idjgpsa4ylztxt6prhdtxpd)

è¨˜äº‹ãƒ‡ãƒ¼ã‚¿ã‚’ä½œã‚Šã¾ã™ã€‚ã“ã¡ã‚‰ã‚‚ãƒªã‚¹ãƒˆå½¢å¼ã§ã‚¿ã‚°ã®ç¨®é¡ã¯ `è¤‡æ•°ã‚³ãƒ³ãƒ†ãƒ³ãƒ„å‚ç…§` ã§å…ˆç¨‹ä½œã£ãŸã‚¿ã‚°ã‚’ç´ä»˜ã‘ã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/r8j09cwac9fk8h6u5ku7wgf6nvda)

ã‚¹ã‚­ãƒ¼ãƒãŒè¨­å®šçµ‚ã‚ã‚Œã°ã€é©å½“ãªã‚¿ã‚°ã¨è¨˜äº‹ã®å†…å®¹ã‚’ç™»éŒ²ã—ã¦ãŠãã¾ã™ã€‚

# GET ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ä¸€è¦§ã‚’å–å¾—

## ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ç¢ºèª

`https://[your-service-name].microcms.io/api/v1/post` ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã™ã‚‹ã¨ã€ä¸‹è¨˜ã®ã‚ˆã†ãªãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒå–å¾—ã§ãã¾ã™ã€‚

```json:/api/v1/post
{
    "contents": [
        {
            "id": "lxwc41jwt",
            "createdAt": "2020-10-13T11:52:05.153Z",
            "updatedAt": "2020-10-13T11:52:05.153Z",
            "publishedAt": "2020-10-13T11:52:05.153Z",
            "title": "è¨˜äº‹2",
            "tag": [
                {
                    "id": "rxayo0c4e",
                    "createdAt": "2020-09-21T06:31:30.797Z",
                    "updatedAt": "2020-09-21T06:31:30.797Z",
                    "publishedAt": "2020-09-21T06:31:30.797Z",
                    "name": "React"
                },
                {
                    "id": "KAYq3aCF0",
                    "createdAt": "2020-09-28T12:12:31.134Z",
                    "updatedAt": "2020-09-28T12:12:31.134Z",
                    "publishedAt": "2020-09-28T12:12:31.134Z",
                    "name": "Next.js"
                }
            ],
            "body": "<p>React ã¨ Next.js ã®è¨˜äº‹</p>"
        },
        {
            "id": "aqbxzshbtj",
            "createdAt": "2020-10-13T11:51:19.794Z",
            "updatedAt": "2020-10-13T11:51:19.794Z",
            "publishedAt": "2020-10-13T11:51:19.794Z",
            "title": "è¨˜äº‹1",
            "tag": [
                {
                    "id": "Bs89dObS_m",
                    "createdAt": "2020-10-06T14:35:19.719Z",
                    "updatedAt": "2020-10-06T14:35:19.719Z",
                    "publishedAt": "2020-10-06T14:35:19.719Z",
                    "name": "TypeScript"
                },
                {
                    "id": "rxayo0c4e",
                    "createdAt": "2020-09-21T06:31:30.797Z",
                    "updatedAt": "2020-09-21T06:31:30.797Z",
                    "publishedAt": "2020-09-21T06:31:30.797Z",
                    "name": "React"
                }
            ],
            "body": "<p>TypeScript ã¨ React ã®è¨˜äº‹</p>"
        }
    ],
    "totalCount": 2,
    "offset": 0,
    "limit": 10
}
```

## å‹ã®å®šç¾©

ã“ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å‹ã‚’å®šç¾©ã—ã¦ã„ãã¾ã™ã€‚contents å†…ã® id, createdAt, updatedAt, publishedAt ã¨
totalCount, offset, limit ã¯å…±æœ‰ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã§æ¯å›ä½¿ã†ã®ã§ apis/common.ts ã«å®šç¾©ã—ã¦ãŠãã¾ã™ã€‚

```typescript:apis/common.ts
// microCMS ã‹ã‚‰è¿”ã£ã¦ãã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å…±é€šãƒ—ãƒ­ãƒ‘ãƒ†ã‚£
export interface CommonItem {
  id: string
  createdAt: string
  updatedAt: string
  publishedAt: string
}

// microCMS ã‹ã‚‰è¿”ã£ã¦ãã‚‹ãƒªã‚¹ãƒˆã®å…±é€šãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ T ã«ä¸Šè¨˜ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒå…¥ã‚‹
export interface CommonList<T> {
  contents: T[]
  totalCount: number
  offset: number
  limit: number
}
```

æ¬¡ã« apis/post/index.ts ã‚’ä½œæˆã—ã¾ã™ã€ã“ã®ãƒ‘ã‚¹ã¯ API ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¨åŒã˜ãƒ‘ã‚¹ã«ã—ã¦ãã ã•ã„ã€‚

```typescript:apis/post/index.ts
import { CommonItem, CommonList } from '../common'

interface TagItem extends CommonItem {
  name: string
}

// å¾Œè¿°ã®è¨˜äº‹ã‚’1ä»¶å–å¾—ã™ã‚‹æ™‚ã«ä½¿ã†ã®ã§ export ã—ã¦ã„ã¾ã™
export interface ArticleItem extends CommonItem {
  title: string
  description: string
  tags: TagItem[]
  markdown: string
}

// APIã®å‹å®šç¾©
export interface Methods {
  get: {
    resBody: CommonList<ArticleItem>
  }
}
```

## aspida ã®å‹å®šç¾©ã‚’ãƒ“ãƒ«ãƒ‰ã™ã‚‹

package.json ã« npm ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’è¿½åŠ ã—ã¾ã™ã€‚

```json:package.json
{
  "scripts": {
    "api:build": "aspida"
  }
}
```

`yarn api:build` ã‚’å®Ÿè¡Œã™ã‚‹ã¨ apis/$api.ts ãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚

```typescript:apis/$api.ts
/* eslint-disable */
import { AspidaClient } from 'aspida'
import { Methods as Methods0 } from './article'

const api = <T>({ baseURL, fetch }: AspidaClient<T>) => {
  const prefix = (baseURL === undefined ? '' : baseURL).replace(/\/$/, '')
  const PATH0 = '/article'
  const GET = 'GET'

  return {
    article: {
      get: (option?: { config?: T }) =>
        fetch<Methods0['get']['resBody']>(prefix, PATH0, GET, option).json(),
      $get: (option?: { config?: T }) =>
        fetch<Methods0['get']['resBody']>(prefix, PATH0, GET, option).json().then(r => r.body),
      $path: () => `${prefix}${PATH0}`
    }
  }
}

export type ApiInstance = ReturnType<typeof api>
export default api

```

## fetch ã‹ã‚‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆ

fetch ã‚’ä½¿ã£ã¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆã™ã‚‹éš›ã«ã¯ aspida ã‚’ãƒ©ãƒƒãƒ‘ãƒ¼ã«ä½¿ç”¨ã—ã¾ã™ã€‚
microCMS ã®å ´åˆã€ãƒ˜ãƒƒãƒ€ãƒ¼ã«ã¯ X-API-KEY ã‚’å«ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```typescript
import aspida from '@aspida/fetch';
import api from '~/apis/$api';

const url = 'https://[your-service-name].microcms.io/api/v1';
const config = {headers: {'X-API-KEY': 'XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX'}};

const getList = async () => {
  const _fetch = api(aspida(fetch, {baseURL: `${url}/post`}));

  // res ãŒ CommonList<ArticleItem> å‹ã«ãªã£ã¦ã„ã‚‹
  const res = await _fetch.article.$get({config});
};
```

## GET ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§è¨˜äº‹ã‚’ 1 ä»¶å–å¾—

`https://[your-service-name].microcms.io/api/v1/post/lxwc41jwt` ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã™ã‚‹ã¨ã€ä¸‹è¨˜ã®ã‚ˆã†ãªãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒå–å¾—ã§ãã¾ã™ã€‚å…ˆç¨‹å–å¾—ã—ãŸä¸€è¦§ã® contents ã®ä¸­èº«ãŒ 1 ä»¶è¿”ã£ã¦ãã¾ã™ã€‚

```json:/post/lxwc41jwt
{
    "id": "lxwc41jwt",
    "createdAt": "2020-10-13T11:52:05.153Z",
    "updatedAt": "2020-10-13T11:52:05.153Z",
    "publishedAt": "2020-10-13T11:52:05.153Z",
    "title": "è¨˜äº‹2",
    "tag": [
        {
            "id": "rxayo0c4e",
            "createdAt": "2020-09-21T06:31:30.797Z",
            "updatedAt": "2020-09-21T06:31:30.797Z",
            "publishedAt": "2020-09-21T06:31:30.797Z",
            "name": "React"
        },
        {
            "id": "KAYq3aCF0",
            "createdAt": "2020-09-28T12:12:31.134Z",
            "updatedAt": "2020-09-28T12:12:31.134Z",
            "publishedAt": "2020-09-28T12:12:31.134Z",
            "name": "Next.js"
        }
    ],
    "body": "<p>React ã¨ Next.js ã®è¨˜äº‹</p>"
}
```

aspida ã®å‹å®šç¾©ã¯ apis/article/_contentId@string/index.ts ã«è¨˜è¿°ã—ã¾ã™ã€‚
ãƒ•ã‚¡ã‚¤ãƒ«åã® `_`ã§å§‹ã¾ã‚‹éƒ¨åˆ†ãŒãƒ‘ã‚¹å¤‰æ•°ã§`@`ã®å¾Œã‚ã«`number`ã‚‚ã—ãã¯`string`ã®å‹ã‚’æŒ‡å®šã—ã¾ã™ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯`number | string` ã§ã™ã€‚

```typescript:apis/article/_contentId@string/index.ts
import { ArticleItem } from '../'

export interface Methods {
  get: {
    resBody: ArticleItem
  }
}

```

å‹ãŒå®šç¾©ã§ããŸã‚‰å…ˆã»ã©ã¨åŒæ§˜ã« `yarn api:build` ã‚’å®Ÿè¡Œã—ã¦ `apis/$api.ts` ã‚’æ›´æ–°ã—ã¾ã™ã€‚

ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æŠ•ã’ã‚‹éš›ã¯ `_contentId()` ã«å¤‰æ•°ã‚’æ¸¡ã—ã¦ `$get()` ã—ã¾ã™ã€‚

```typescript
import aspida from '@aspida/fetch';
import api from '~/apis/$api';

const url = 'https://[your-service-name].microcms.io/api/v1';
const config = {headers: {'X-API-KEY': 'XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX'}};

const getPost = async (id: string) => {
  const _fetch = api(aspida(fetch, {baseURL: `${url}/post`}));

  // res ãŒ ArticleItem å‹ã«ãªã£ã¦ã„ã‚‹
  const res = await _fetch.article._contentId(id).$get({config});
};
```

# ã¾ã¨ã‚

ä»Šå›ã¯ aspida ã‚’ä½¿ã£ã¦ GET ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å‹ã‚’å®šç¾©ã™ã‚‹æ–¹æ³•ã ã‘ã‚’ç´¹ä»‹ã—ã¾ã—ãŸãŒã€
ãã®ã»ã‹ã«ã‚‚ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚ã®ãƒ‘ãƒ©ãƒ¡ã‚¿ã€`PUST` / `PUT` / `PATCH` / `DELETE` ã¨ã„ã£ãŸã»ã‹ã®ãƒ¡ã‚½ãƒƒãƒ‰ã®å‹ã‚‚å®šç¾©ã§ãã¾ã™ã€‚
